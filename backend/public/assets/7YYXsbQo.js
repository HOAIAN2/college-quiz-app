import{b as c,d as k,A as Q,i as B,e as A,Q as x,S as Y,k as g,j as e,c as m,f as K,R as z,a as o,v as M,F as R,m as V,n as X,X as W,u as Z,O as ee,y as se,N as te,L as ae,U as re}from"./B7DAq_4k.js";import{R as ne}from"./P0sdvjL8.js";import{a as ce,b as oe}from"./BRwh3y8v.js";import{c as ie}from"./D3wkX606.js";import{f as ue}from"./jgNAs1tW.js";import{u as F}from"./f4lojql9.js";import{s}from"./Bn4G0VvL.js";import{C as G}from"./DqT24KQI.js";import{s as u}from"./C9q1ODpn.js";function le({semester:f,numberOfCourses:h,onMutateSuccess:E,setShowPopUp:_}){const[N,p]=c.useState(!0),t=k("component.create_course"),[j,l]=c.useState(""),[v,U]=c.useState(""),[D,i]=c.useState(""),n=F(j,Q),S=F(v,Q),d=B(),y=()=>{p(!0),setTimeout(()=>{_(!1)},V.TRANSITION_TIMING_FAST)},r=X(s),O=A({queryKey:[x.AUTO_COMPLETE_SUBJECT,{search:n}],queryFn:()=>Y("teacher",n),enabled:!!n}),w=A({queryKey:[x.AUTO_COMPLETE_SUBJECT,{search:S}],queryFn:()=>ue(S),enabled:!!S}),$=async a=>{var P;a.preventDefault(),(P=document.querySelector(`.${s["form-data"]}`))==null||P.querySelectorAll("input[name]").forEach(I=>{var L;I.classList.remove("error"),(L=r.getParentElement(I))==null||L.removeAttribute("data-error")});const C=a.nativeEvent.submitter,b=a.target,q=new FormData(b);await ce(q),C.name==="save"?y():b.reset()},{mutate:H,isPending:T}=g({mutationFn:$,onError:a=>{r.showFormError(a)},onSuccess:E}),J=a=>{const C=new Date(f.startDate),b=new Date(f.endDate),q=[C.getDate(),C.getMonth()+1,b.getDate(),b.getMonth()+1,M.getShortHand(a.label),h+1].join("");i(q)};return c.useEffect(()=>(p(!1),()=>{d.removeQueries({queryKey:[x.AUTO_COMPLETE_USER]})}),[d]),e.jsxs("div",{className:m(s["create-model-container"],N?s.hide:""),children:[T?e.jsx(K,{}):null,e.jsxs("div",{className:m(s["create-model-form"],N?s.hide:""),children:[e.jsxs("div",{className:s.header,children:[e.jsx("h2",{className:s.title,children:t==null?void 0:t.create}),e.jsx("div",{className:s["esc-button"],onClick:y,children:e.jsx(z,{})})]}),e.jsx("div",{className:s["form-content"],children:e.jsxs("form",{onSubmit:a=>{H(a)},onInput:a=>{r.handleOnInput(a)},className:s["form-data"],children:[e.jsx("input",{name:"semester_id",value:f.id,readOnly:!0,hidden:!0}),e.jsxs("div",{className:s["group-inputs"],children:[e.jsxs("div",{className:s["wrap-item"],children:[e.jsx("label",{className:s.required,htmlFor:"shortcode",children:t==null?void 0:t.shortcode}),e.jsx("input",{id:"shortcode",name:"shortcode",value:D,onInput:a=>{i(a.currentTarget.value)},className:m(o["input-d"],s["input-item"]),type:"text"})]}),e.jsxs("div",{className:s["wrap-item"],children:[e.jsx("label",{className:s.required,htmlFor:"name",children:t==null?void 0:t.name}),e.jsx("input",{id:"name",name:"name",className:m(o["input-d"],s["input-item"]),type:"text"})]}),e.jsxs("div",{style:{zIndex:2},className:s["wrap-item"],children:[e.jsx("label",{className:s.required,htmlFor:"teacher_id",children:t==null?void 0:t.teacher}),e.jsx(G,{name:"teacher_id",onInput:a=>{l(a.currentTarget.value)},options:O.data?O.data.map(a=>({label:M.getFullName(a.firstName,a.lastName),value:String(a.id)})):[],className:s["custom-select"]})]}),e.jsxs("div",{className:s["wrap-item"],children:[e.jsx("label",{className:s.required,htmlFor:"subject_id",children:t==null?void 0:t.subject}),e.jsx(G,{name:"subject_id",onInput:a=>{U(a.currentTarget.value)},options:w.data?w.data.map(a=>({label:a.name,value:String(a.id)})):[],onChange:J,className:s["custom-select"]})]})]}),e.jsxs("div",{className:s["action-items"],children:[e.jsxs("button",{name:"save",className:m(o["action-item-d"],T?o["button-submitting"]:""),children:[e.jsx(R,{}),t==null?void 0:t.save]}),e.jsxs("button",{name:"save-more",className:m(o["action-item-white-d"],T?o["button-submitting"]:""),children:[e.jsx(R,{}),t==null?void 0:t.saveMore]})]})]})})]})]})}function be(){const{state:f}=W(),[h,E]=c.useState(f),[_,N]=c.useState(!1),{permissions:p,appTitle:t}=Z(),{id:j}=ee(),[l,v]=se(),[U,D]=c.useState(l.get("search")||""),i=F(U),n=k("page.courses"),S=B(),d=A({queryKey:[x.PAGE_COURSES,{search:i,semesterId:Number(j)}],queryFn:()=>oe({search:i,semesterId:Number(j)||void 0}),enabled:p.has("course_view")});c.useEffect(()=>{ie(String(j)).then(r=>{E(r)})},[j]);const y=()=>{[x.PAGE_COURSES,x.PAGE_DASHBOARD].forEach(r=>{S.refetchQueries({queryKey:[r]})})};return c.useEffect(()=>{!l.get("search")&&!i||(i===""?l.delete("search"):l.set("search",i),v(l))},[i,l,v]),c.useEffect(()=>{n&&h&&t.setAppTitle(n.title.replace("@semester",h.name))},[t,n,h]),h?p.has("course_view")?e.jsxs(e.Fragment,{children:[_&&d.data?e.jsx(le,{semester:h,numberOfCourses:d.data.length,onMutateSuccess:y,setShowPopUp:N}):null,e.jsxs("main",{className:o["dashboard-d"],children:[p.hasAnyFormList(["course_create"])?e.jsx("section",{className:o["action-bar-d"],children:p.has("course_create")?e.jsxs("div",{className:o["action-item-d"],onClick:()=>{N(!0)},children:[e.jsx(ne,{})," ",n==null?void 0:n.add]}):null}):null,e.jsxs("section",{className:u["page-content"],children:[d.isLoading?e.jsx(K,{}):null,e.jsx("div",{className:u["filter-form"],children:e.jsxs("div",{className:u["wrap-input-item"],children:[e.jsx("label",{children:n==null?void 0:n.filter.search}),e.jsx("input",{onInput:r=>{D(r.currentTarget.value)},defaultValue:i,className:m(o["input-d"],u["input-item"])})]})}),e.jsx("div",{className:u["wrap-card-container"],children:e.jsx("div",{className:u["card-container"],children:d.data?d.data.map(r=>e.jsxs(ae,{to:`${r.id}`,className:m(o["dashboard-card-d"],u.card),children:[e.jsx("div",{className:u["card-top"],children:r.name}),e.jsxs("div",{className:u["card-bottom"],children:[e.jsx(re,{}),r.shortcode]})]},`course-${r.id}`)):null})})]})]})]}):e.jsx(te,{to:"/"}):null}export{be as default};
