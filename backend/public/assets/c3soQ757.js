import{r as P,p as Q,T as se,G as re,b as h,d as K,k as B,j as e,c as j,f as L,R as H,C as F,a as u,W as J,M as $,F as M,m as W,n as X,u as Z,i as ae,e as g,Q as G,X as ne,y as ie,O as oe,N as ce,Y as le}from"./B7DAq_4k.js";import{R}from"./P0sdvjL8.js";import{c as de}from"./jgNAs1tW.js";import{s as c}from"./Bn4G0VvL.js";import{g as l}from"./CT1-FNmN.js";import{Y as ue}from"./BQMOT6f8.js";import{u as me}from"./f4lojql9.js";import{s as w}from"./C9q1ODpn.js";const U="questions";async function pe(o){try{const r=await P.get(Q.join(U),{params:{subject_id:o.subjectId,chapter_id:o.chapterId,search:o.search}}),{data:d}=r.data;return d}catch(r){throw new Error(r.message)}}async function he(o){try{await P.post(Q.join(U),o)}catch(r){if(!r.response)throw new Error(r.message);const d=r.response.data.message;if(r.response.data.errors)return Promise.reject(r.response.data.errors);throw new Error(d)}}async function xe(o){try{const r=await P.get(Q.join(U,o)),{data:d}=r.data;return d}catch(r){throw new Error(r.message)}}async function je(o,r){try{const d=se(o);await P.put(Q.join(U,r),d,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}catch(d){if(!d.response)throw new Error(d.message);const p=d.response.data.message;if(d.response.data.errors)return Promise.reject(d.response.data.errors);throw new Error(p)}}async function fe(o){try{await P.delete(Q.join(U,o))}catch(r){if(!r.response)throw new Error(r.message);const d=r.response.data.message;if(r.response.data.errors)return Promise.reject(r.response.data.errors);throw new Error(d)}}function ee(o){return re({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416zm0 464A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-111 111-47-47c-9.4-9.4-24.6-9.4-33.9 0s-9.4 24.6 0 33.9l64 64c9.4 9.4 24.6 9.4 33.9 0L369 209z"},child:[]}]})(o)}const ve="yVgOJiwOhJI-",C={"textarea-group":"_2Ow5gd4jzZk-","wrap-label":"_0GDNqQrlxKg-",textarea:ve};function A(o){const r=o.currentTarget;r.style.height="auto",r.style.height=r.scrollHeight+"px"}function Ne({subjectDetail:o,onMutateSuccess:r,setShowPopUp:d}){const[p,N]=h.useState(!0),[b,I]=h.useState(new Array(2).fill(null).map((i,v)=>({key:v.toString(),content:""}))),[S,O]=h.useState(),s=K("component.create_question"),k=()=>{N(!0),setTimeout(()=>{d(!1)},W.TRANSITION_TIMING_FAST)},_=X(c),E=async i=>{var m;i.preventDefault(),(m=document.querySelector(c["form-data"]))==null||m.querySelectorAll("input[name]").forEach(D=>{var T;D.classList.remove("error"),(T=_.getParentElement(D))==null||T.removeAttribute("data-error")});const v=i.nativeEvent.submitter,n=i.target,x=new FormData(n);await he(x),v.name==="save"?k():n.reset()},{mutate:t,isPending:f}=B({mutationFn:E,onError:i=>{_.showFormError(i)},onSuccess:r});return h.useEffect(()=>{N(!1)},[]),e.jsxs("div",{className:j(c["create-model-container"],p?c.hide:""),children:[f?e.jsx(L,{}):null,e.jsxs("div",{className:j(c["create-model-form"],p?c.hide:""),children:[e.jsxs("div",{className:c.header,children:[e.jsx("h2",{className:c.title,children:s==null?void 0:s.create}),e.jsx("div",{className:c["esc-button"],onClick:k,children:e.jsx(H,{})})]}),e.jsx("div",{className:c["form-content"],children:e.jsxs("form",{onSubmit:i=>{t(i)},onInput:i=>{_.handleOnInput(i)},className:c["form-data"],children:[e.jsx("input",{name:"true_option",readOnly:!0,hidden:!0,value:b.findIndex(i=>i.key===S)}),e.jsx("input",{name:"subject_id",readOnly:!0,hidden:!0,value:o.id}),e.jsxs("div",{className:c["group-inputs"],children:[e.jsxs("div",{style:{zIndex:2},className:c["wrap-item"],children:[e.jsx("label",{children:s==null?void 0:s.chapter}),e.jsx(F,{name:"chapter_id",defaultOption:{label:s==null?void 0:s.unselect,value:""},options:[{label:s==null?void 0:s.unselect,value:""},...o.chapters.map(i=>({value:String(i.id),label:`${i.chapterNumber}. ${i.name}`}))],className:c["custom-select"]})]}),e.jsxs("div",{className:c["wrap-item"],children:[e.jsx("label",{className:c.required,children:s==null?void 0:s.level}),e.jsx(F,{name:"level",defaultOption:{label:s==null?void 0:s.questionLevel.easy,value:"easy"},options:s?Object.keys(s.questionLevel).map(i=>({value:i,label:s.questionLevel[i]})):[],className:c["custom-select"]})]}),e.jsxs("div",{className:j(c["wrap-item"],c.textarea),children:[e.jsx("label",{className:c.required,htmlFor:"content",children:s==null?void 0:s.content}),e.jsx("textarea",{onChange:A,name:"content",id:"content",className:j(u["input-d"],c["input-item"])})]}),e.jsx("div",{style:{paddingLeft:"20px"},className:u["action-bar-d"],children:e.jsxs("div",{style:{width:"fit-content"},className:u["action-item-d"],onClick:()=>{I([...b,{key:new Date().getTime().toString(),content:""}])},children:[e.jsx(R,{})," ",s==null?void 0:s.addOption]})}),b.map((i,v)=>e.jsxs("div",{className:j(C["textarea-group"],c["wrap-item"],c.textarea),children:[e.jsxs("div",{className:C["wrap-label"],children:[e.jsx("label",{style:{cursor:"pointer"},className:c.required,onClick:()=>{O(String(i.key))},children:`${s==null?void 0:s.answer} ${v+1}`}),i.key===S?e.jsx(ee,{}):null]}),e.jsx("textarea",{"data-selector":`options.${v}`,onInput:A,name:"options[]",className:j(u["input-d"],c["input-item"],C.textarea)}),e.jsxs("div",{onClick:()=>{b.length==2?J.error(s==null?void 0:s.deleteOptionError):I(b.filter(n=>n.key!==i.key))},className:u["action-item-white-border-red-d"],children:[e.jsx($,{})," ",s==null?void 0:s.delete]})]},i.key))]}),e.jsxs("div",{className:c["action-items"],children:[e.jsxs("button",{name:"save",className:j(u["action-item-d"],f?u["button-submitting"]:""),children:[e.jsx(M,{}),s==null?void 0:s.save]}),e.jsxs("button",{name:"save-more",className:j(u["action-item-white-d"],f?u["button-submitting"]:""),children:[e.jsx(M,{}),s==null?void 0:s.saveMore]})]})]})})]})]})}function ye({id:o,subjectDetail:r,onMutateSuccess:d,setShowPopUp:p}){const{permissions:N}=Z(),[b,I]=h.useState(!0),[S,O]=h.useState([]),[s,k]=h.useState(!1),[_,E]=h.useState(),t=K("component.view_question"),f=ae(),i=()=>{I(!0),setTimeout(()=>{p(!1)},W.TRANSITION_TIMING_FAST)},v=X(l),n=!N.has("question_update"),x=g({queryKey:[G.QUESTION_DETAIL,{id:o}],queryFn:()=>xe(o)}),m=async a=>{var z;a.preventDefault(),(z=document.querySelector(`.${C["form-data"]}`))==null||z.querySelectorAll("input[name]").forEach(V=>{var Y;V.classList.remove("error"),(Y=v.getParentElement(V))==null||Y.removeAttribute("data-error")});const q=a.target,y=new FormData(q);await je(y,o)},{mutate:D,isPending:T}=B({mutationFn:m,onError:a=>{v.showFormError(a)},onSuccess:d}),te=async()=>{await fe(o)};return h.useEffect(()=>(I(!1),()=>{f.removeQueries({queryKey:[G.QUESTION_DETAIL,{id:o}]})}),[o,f]),h.useEffect(()=>{var a;if(x.data){const q=x.data.questionOptions.map(y=>({key:y.id.toString(),content:y.content,isCorrect:y.isCorrect}));O(q.map(y=>({key:y.key,content:y.content}))),E((a=q.find(y=>y.isCorrect))==null?void 0:a.key)}},[x.data]),e.jsxs(e.Fragment,{children:[s===!0?e.jsx(ue,{message:(t==null?void 0:t.deleteMessage)||"",mutateFunction:te,setShowPopUp:k,onMutateSuccess:()=>{d(),i()},langYes:t==null?void 0:t.langYes,langNo:t==null?void 0:t.langNo}):null,e.jsxs("div",{className:j(l["view-model-container"],b?l.hide:""),children:[T?e.jsx(L,{}):null,e.jsxs("div",{className:j(l["view-model-form"],b?l.hide:""),children:[e.jsxs("div",{className:l.header,children:[e.jsx("h2",{className:l.title,children:t==null?void 0:t.title}),e.jsx("div",{className:l["esc-button"],onClick:i,children:e.jsx(H,{})})]}),e.jsxs(e.Fragment,{children:[x.isLoading?e.jsx(L,{}):null,e.jsx("div",{className:l["form-content"],children:x.data?e.jsxs("form",{onSubmit:a=>{D(a)},onInput:a=>{v.handleOnInput(a)},className:l["form-data"],children:[e.jsx("input",{name:"true_option",readOnly:!0,hidden:!0,value:S.findIndex(a=>a.key===_)}),e.jsx("input",{name:"subject_id",readOnly:!0,hidden:!0,value:r.id}),e.jsxs("div",{className:l["group-inputs"],children:[e.jsxs("div",{style:{zIndex:2},className:l["wrap-item"],children:[e.jsx("label",{htmlFor:"chapter_id",children:t==null?void 0:t.chapter}),e.jsx(F,{name:"chapter_id",disabled:n,defaultOption:(()=>{const a=r.chapters.find(q=>q.id==x.data.chapterId);return{label:(a==null?void 0:a.name)||(t==null?void 0:t.unselect),value:String((a==null?void 0:a.id)||"")}})(),options:[{label:t==null?void 0:t.unselect,value:""},...r.chapters.map(a=>({value:String(a.id),label:`${a.chapterNumber}. ${a.name}`}))],className:l["custom-select"]})]}),e.jsxs("div",{className:l["wrap-item"],children:[e.jsx("label",{className:l.required,children:t==null?void 0:t.level}),e.jsx(F,{name:"level",disabled:n,defaultOption:{label:t==null?void 0:t.questionLevel[x.data.level],value:x.data.level},options:t?Object.keys(t.questionLevel).map(a=>({value:a,label:t.questionLevel[a]})):[],className:l["custom-select"]})]}),e.jsxs("div",{className:j(l["wrap-item"],l.textarea),children:[e.jsx("label",{className:l.required,htmlFor:"content",children:t==null?void 0:t.content}),e.jsx("textarea",{disabled:n,defaultValue:x.data.content,onInput:A,name:"content",id:"content",className:j(u["input-d"],l["input-item"]),cols:30,rows:50})]}),N.has("question_update")?e.jsx("div",{style:{paddingLeft:"20px"},className:u["action-bar-d"],children:e.jsxs("div",{style:{width:"fit-content"},className:u["action-item-d"],onClick:()=>{O([...S,{key:new Date().getTime().toString(),content:""}])},children:[e.jsx(R,{})," ",t==null?void 0:t.addOption]})}):null]}),e.jsx("div",{className:l["group-inputs"],children:S.map((a,q)=>e.jsxs("div",{className:j(C["textarea-group"],l["wrap-item"],l.textarea),children:[e.jsxs("div",{className:C["wrap-label"],children:[e.jsx("label",{style:{cursor:"pointer"},className:l.required,onClick:()=>{E(String(a.key))},children:`${t==null?void 0:t.answer} ${q+1}`}),a.key===_?e.jsx(ee,{}):null]}),e.jsx("textarea",{defaultValue:a.content,"data-selector":`options.${q}`,onInput:A,name:"options[]",disabled:n,className:j(u["input-d"],l["input-item"],C.textarea),cols:30,rows:50}),N.has("question_update")?e.jsxs("div",{onClick:()=>{S.length==2?J.error(t==null?void 0:t.deleteOptionError):O(S.filter(y=>y.key!==a.key))},className:u["action-item-white-border-red-d"],children:[e.jsx($,{})," ",t==null?void 0:t.delete]}):null]},a.key))}),N.hasAnyFormList(["question_update","question_delete"])?e.jsxs("div",{className:l["action-items"],children:[N.has("question_update")?e.jsxs("button",{name:"save",className:j(u["action-item-d"],T?"button-submitting":""),children:[e.jsx(M,{}),t==null?void 0:t.save]}):null,N.has("question_delete")?e.jsxs("button",{type:"button",onClick:()=>{k(!0)},className:u["action-item-white-border-red-d"],children:[e.jsx($,{})," ",t==null?void 0:t.delete]}):null]}):null]}):null})]})]})]})]})}function Ee(){const{state:o}=ne(),[r,d]=h.useState(o),[p,N]=ie(),[b,I]=h.useState(!1),[S,O]=h.useState(p.get("search")||""),[s,k]=h.useState(0),[_,E]=h.useState(!1),t=me(S),{permissions:f,appTitle:i}=Z(),{id:v}=oe(),n=K("page.questions"),x=g({queryKey:[G.PAGE_QUESTIONS,{chapter:p.get("chapter")||"10",search:t}],queryFn:()=>pe({subjectId:String(v),chapterId:p.get("chapter"),search:t}),enabled:f.has("question_view")&&f.has("subject_view")});return h.useEffect(()=>{f.has("subject_view")&&de(String(v)).then(m=>{d(m)})},[v,f]),h.useEffect(()=>{!p.get("search")&&!t||(t===""?p.delete("search"):p.set("search",t),N(p))},[t,p,N]),h.useEffect(()=>{n&&r&&i.setAppTitle(n.title.replace("@subject",r.name))},[i,n,r]),!f.has("question_view")||!f.has("subject_view")?e.jsx(ce,{to:"/"}):r?e.jsxs(e.Fragment,{children:[_===!0?e.jsx(ye,{id:s,subjectDetail:r,setShowPopUp:E,onMutateSuccess:()=>{x.refetch()}}):null,b===!0?e.jsx(Ne,{onMutateSuccess:()=>{x.refetch()},setShowPopUp:I,subjectDetail:r}):null,e.jsxs("main",{className:u["dashboard-d"],children:[f.hasAnyFormList(["question_create"])?e.jsx("section",{className:u["action-bar-d"],children:f.has("question_create")?e.jsxs("div",{className:u["action-item-d"],onClick:()=>{I(!0)},children:[e.jsx(R,{})," ",n==null?void 0:n.add]}):null}):null,e.jsxs("section",{className:w["page-content"],children:[x.isLoading?e.jsx(L,{}):null,e.jsxs("div",{className:w["filter-form"],children:[e.jsxs("div",{className:w["wrap-input-item"],children:[e.jsx("label",{children:n==null?void 0:n.filter.chapter}),e.jsx(F,{defaultOption:{label:n==null?void 0:n.unselect,value:""},options:[{label:n==null?void 0:n.unselect,value:""},...r.chapters.map(m=>({value:String(m.id),label:`${m.chapterNumber}. ${m.name}`}))],onChange:m=>{m.value!=""?p.set("chapter",m.value):p.delete("chapter"),N(p)},className:w["custom-select"]})]}),e.jsxs("div",{className:w["wrap-input-item"],children:[e.jsx("label",{htmlFor:"",children:n==null?void 0:n.filter.search}),e.jsx("input",{onInput:m=>{O(m.currentTarget.value)},name:"search",defaultValue:t,className:j(u["input-d"],w["input-item"])})]})]}),e.jsx("div",{className:w["wrap-card-container"],children:e.jsx("div",{className:w["card-container"],children:x.data?x.data.map(m=>e.jsxs("div",{onClick:()=>{k(m.id),E(!0)},className:j(u["dashboard-card-d"],w.card),children:[e.jsx("div",{className:w["card-top"],children:e.jsx("p",{className:w.content,children:m.content})}),e.jsxs("div",{className:w["card-bottom"],children:[e.jsx(le,{}),n==null?void 0:n.questionLevel[m.level]]})]},`subject-${m.id}`)):null})})]})]})]}):null}export{Ee as default};
