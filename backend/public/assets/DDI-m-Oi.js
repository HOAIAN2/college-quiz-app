import{r as A,p as T,T as H,d as k,b as j,k as M,j as e,c as u,f as U,R as Q,a as l,F as D,m as R,n as L,u as $,M as J,O as W,i as X,V as Z,e as g,Q as I,N as ee,L as te}from"./B7DAq_4k.js";import{R as se}from"./P0sdvjL8.js";import{c as ae,d as re,e as ne}from"./jgNAs1tW.js";import{s as d}from"./Bn4G0VvL.js";import{g as m}from"./CT1-FNmN.js";import{Y as K}from"./BQMOT6f8.js";const V="chapters";async function oe(o){try{await A.post(T.join(V),o)}catch(s){if(!s.response)throw new Error(s.message);const t=s.response.data.message;if(s.response.data.errors)return Promise.reject(s.response.data.errors);throw new Error(t)}}async function ie(o,s){try{const t=H(o);await A.put(T.join(V,s),t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})}catch(t){if(!t.response)throw new Error(t.message);const x=t.response.data.message;if(t.response.data.errors)return Promise.reject(t.response.data.errors);throw new Error(x)}}async function ce(o){try{await A.delete(T.join(V,o))}catch(s){if(!s.response)throw new Error(s.message);const t=s.response.data.message;if(s.response.data.errors)return Promise.reject(s.response.data.errors);throw new Error(t)}}function de({defaultChapterNumber:o,subjectId:s,onMutateSuccess:t,setShowPopUp:x}){const i=k("component.create_chapter"),[f,v]=j.useState(!0),a=()=>{v(!0),setTimeout(()=>{x(!1)},R.TRANSITION_TIMING_FAST)},N=L(d),w=async h=>{var p;h.preventDefault(),(p=document.querySelector(`.${d["form-data"]}`))==null||p.querySelectorAll("input[name]").forEach(C=>{var F;C.classList.remove("error"),(F=N.getParentElement(C))==null||F.removeAttribute("data-error")});const y=h.nativeEvent.submitter,c=h.target,E=new FormData(c);await oe(E),y.name==="save"?a():c.reset()},{mutate:S,isPending:b}=M({mutationFn:w,onError:h=>{N.showFormError(h)},onSuccess:t});return j.useEffect(()=>{v(!1)},[]),e.jsxs("div",{className:u(d["create-model-container"],f?d.hide:""),children:[b?e.jsx(U,{}):null,e.jsxs("div",{className:u(d["create-model-form"],f?d.hide:""),children:[e.jsxs("div",{className:d.header,children:[e.jsx("h2",{className:d.title,children:i==null?void 0:i.create}),e.jsx("div",{className:d["esc-button"],onClick:a,children:e.jsx(Q,{})})]}),e.jsx("div",{className:d["form-content"],children:e.jsxs("form",{onSubmit:h=>{S(h)},onInput:h=>{N.handleOnInput(h)},className:d["form-data"],children:[e.jsxs("div",{className:d["group-inputs"],children:[e.jsx("input",{readOnly:!0,hidden:!0,name:"subject_id",value:s}),e.jsxs("div",{className:d["wrap-item"],children:[e.jsx("label",{className:d.required,htmlFor:"chapter_number",children:i==null?void 0:i.chapterNumber}),e.jsx("input",{id:"chapter_number",name:"chapter_number",defaultValue:o,className:u(l["input-d"],d["input-item"]),type:"text"})]}),e.jsxs("div",{className:d["wrap-item"],children:[e.jsx("label",{className:d.required,htmlFor:"name",children:i==null?void 0:i.name}),e.jsx("input",{id:"name",name:"name",className:u(l["input-d"],d["input-item"]),type:"text"})]})]}),e.jsxs("div",{className:d["action-items"],children:[e.jsxs("button",{name:"save",className:u(l["action-item-d"],b?l["button-submitting"]:""),children:[e.jsx(D,{}),i==null?void 0:i.save]}),e.jsxs("button",{name:"save-more",className:u(l["action-item-white-d"],b?l["button-submitting"]:""),children:[e.jsx(D,{}),i==null?void 0:i.saveMore]})]})]})})]})]})}function me({data:o,onMutateSuccess:s,setShowPopUp:t}){const[x,i]=j.useState(!0),[f,v]=j.useState(!1),a=k("component.view_chapter"),{permissions:N}=$(),w=()=>{i(!0),setTimeout(()=>{t(!1)},R.TRANSITION_TIMING_FAST)},S=L(m),b=!N.has("subject_update"),h=async p=>{var q;p.preventDefault(),(q=document.querySelector(`.${m["form-data"]}`))==null||q.querySelectorAll("input[name]").forEach(_=>{var r;_.classList.remove("error"),(r=S.getParentElement(_))==null||r.removeAttribute("data-error")});const C=p.target,F=new FormData(C);await ie(F,o.id)},y=async()=>{await ce(o.id)},{mutate:c,isPending:E}=M({mutationFn:h,onError:p=>{S.showFormError(p)},onSuccess:s});return j.useEffect(()=>{i(!1)},[]),e.jsxs(e.Fragment,{children:[f===!0?e.jsx(K,{message:(a==null?void 0:a.deleteMessage)||"",mutateFunction:y,setShowPopUp:v,onMutateSuccess:()=>{s(),w()},langYes:a==null?void 0:a.langYes,langNo:a==null?void 0:a.langNo}):null,e.jsxs("div",{className:u(m["view-model-container"],x?m.hide:""),children:[E?e.jsx(U,{}):null,e.jsxs("div",{className:u(m["view-model-form"],x?m.hide:""),children:[e.jsxs("div",{className:m.header,children:[e.jsx("h2",{className:m.title,children:o.name}),e.jsx("div",{className:m["esc-button"],onClick:w,children:e.jsx(Q,{})})]}),e.jsx(e.Fragment,{children:e.jsx("div",{className:m["form-content"],children:e.jsxs("form",{onSubmit:p=>{c(p)},onInput:p=>{S.handleOnInput(p)},className:m["form-data"],children:[e.jsxs("div",{className:m["group-inputs"],children:[e.jsxs("div",{className:m["wrap-item"],children:[e.jsx("label",{className:m.required,htmlFor:"chapter_number",children:a==null?void 0:a.chapterNumber}),e.jsx("input",{id:"chapter_number",name:"chapter_number",disabled:b,defaultValue:o.chapterNumber,className:u(l["input-d"],m["input-item"]),type:"text"})]}),e.jsxs("div",{className:m["wrap-item"],children:[e.jsx("label",{className:m.required,htmlFor:"name",children:a==null?void 0:a.name}),e.jsx("input",{id:"name",disabled:b,defaultValue:o.name,name:"name",className:u(l["input-d"],m["input-item"]),type:"text"})]})]}),N.has("subject_update")?e.jsxs("div",{className:m["action-items"],children:[e.jsxs("button",{name:"save",className:u(l["action-item-d"],E?"button-submitting":""),children:[e.jsx(D,{}),a==null?void 0:a.save]}),e.jsxs("button",{type:"button",onClick:()=>{v(!0)},className:l["action-item-white-border-red-d"],children:[e.jsx(J,{})," ",a==null?void 0:a.delete]})]}):null]})})})]})]})]})}const le="U8QKK0Lp2Ek-",ue="FqEgtWCIo4c-",he="Iy0JqVqtvvs-",pe="ftMC1rB-rFU-",je="lOvzIqwh-9s-",xe="mkEMYbxrG3w-",n={"page-content":"hdVou1nHmwg-",header:le,title:ue,"form-content":"kl9qlJ2vtFA-","form-data":"sNhT8-miXx4-","group-inputs":"wsJp6qvDLm8-","wrap-item":"WpMhqBt1p7I-",required:he,"input-item":"k57XEK3cEsE-",error:pe,"custom-select":"QhbjjRzeWJ4-","action-items":"_31ceiXaYlPk-",pending:je,"chapters-container":"GJOz6kxYbuA-",card:xe,"card-top":"QhqE6kCKkr0-","card-bottom":"egw-UFFdI0I-"};function ye(){const{id:o}=W(),{permissions:s}=$(),t=k("page.subject"),[x,i]=j.useState(),f=X(),[v,a]=j.useState(!1),[N,w]=j.useState(!1),[S,b]=j.useState(!1),h=Z(),y=L(n),c=g({queryKey:[I.PAGE_SUBJECT,{id:o}],queryFn:()=>ae(String(o)),enabled:s.has("subject_view")}),E=async r=>{var Y;if(r.preventDefault(),!s.has("subject_update"))return;(Y=document.querySelector(`.${n["form-data"]}`))==null||Y.querySelectorAll("input[name]").forEach(z=>{var G;const O=z;O.classList.remove("error"),(G=y.getParentElement(O))==null||G.removeAttribute("data-error")});const P=r.target,B=new FormData(P);c.data&&await ne(B,c.data.id)},{mutate:p,isPending:C}=M({mutationFn:E,onError:r=>{y.showFormError(r)},onSuccess:()=>{c.refetch()}}),F=async()=>{await re(String(o))},q=()=>{[I.PAGE_SUBJECTS].forEach(r=>{f.refetchQueries({queryKey:[r]})}),h("/subjects")},_=c.data&&c.data.chapters.length!==0?Math.max(...c.data.chapters.map(r=>r.chapterNumber))+1:1;return j.useEffect(()=>()=>{f.removeQueries({queryKey:[I.PAGE_SUBJECT,{id:o}]})},[o,f]),s.has("subject_view")?e.jsxs(e.Fragment,{children:[N&&x?e.jsx(me,{data:x,onMutateSuccess:()=>{c.refetch()},setShowPopUp:w}):null,S===!0?e.jsx(de,{defaultChapterNumber:_,subjectId:String(o),onMutateSuccess:()=>{c.refetch()},setShowPopUp:b}):null,v===!0?e.jsx(K,{message:(t==null?void 0:t.deleteMessage)||"",mutateFunction:F,setShowPopUp:a,onMutateSuccess:q,langYes:t==null?void 0:t.langYes,langNo:t==null?void 0:t.langNo}):null,e.jsxs("main",{className:u(l["dashboard-d"],n["page-content"]),children:[c.isLoading?e.jsx(U,{}):null,C?e.jsx(U,{}):null,c.data?e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:n["form-content"],children:[e.jsx("div",{className:n.header,children:e.jsx("h2",{className:n.title,children:c.data.name})}),e.jsxs("form",{onSubmit:r=>{p(r)},onInput:r=>{y.handleOnInput(r)},className:n["form-data"],children:[e.jsx("input",{name:"is_active",defaultValue:"1",hidden:!0}),e.jsxs("div",{className:n["group-inputs"],children:[e.jsxs("div",{className:n["wrap-item"],children:[e.jsx("label",{className:n.required,htmlFor:"shortcode",children:t==null?void 0:t.shortcode}),e.jsx("input",{id:"shortcode",disabled:!s.has("subject_update"),defaultValue:c.data.shortcode,name:"shortcode",className:u(l["input-d"],n["input-item"]),type:"text"})]}),e.jsxs("div",{className:n["wrap-item"],children:[e.jsx("label",{className:n.required,htmlFor:"name",children:t==null?void 0:t.name}),e.jsx("input",{id:"name",disabled:!s.has("subject_update"),defaultValue:c.data.name,name:"name",className:u(l["input-d"],n["input-item"]),type:"text"})]})]}),s.hasAnyFormList(["subject_update","subject_delete"])?e.jsxs("div",{className:n["action-items"],children:[s.has("subject_update")?e.jsx("button",{name:"save",className:u(l["action-item-d"],C?l["button-submitting"]:""),children:t==null?void 0:t.save}):null,s.has("subject_delete")?e.jsxs("button",{type:"button",onClick:()=>{a(!0)},className:l["action-item-white-border-red-d"],children:[e.jsx(J,{})," ",t==null?void 0:t.delete]}):null]}):null]})]}),e.jsx("div",{className:n.header,children:e.jsx("h2",{className:n.title,children:t==null?void 0:t.chapters})}),s.has("subject_update")?e.jsx("div",{className:l["action-bar-d"],style:{paddingLeft:"20px"},children:e.jsxs("div",{className:l["action-item-d"],onClick:()=>{b(!0)},children:[e.jsx(se,{})," ",t==null?void 0:t.add]})}):null,e.jsx("div",{className:n["chapters-container"],children:c.data.chapters.sort((r,P)=>r.chapterNumber-P.chapterNumber).map(r=>e.jsxs("div",{className:u(l["dashboard-card-d"],n.card),onClick:()=>{i(r),w(!0)},children:[e.jsx("div",{className:n["card-top"],children:`${r.chapterNumber}. ${r.name}`}),e.jsx("div",{className:n["card-bottom"],children:`${r.questionsCount} ${t==null?void 0:t.questions.toLocaleLowerCase()}`})]},`chapter-${r.id}`))}),s.has("question_view")?e.jsx(te,{to:"questions",state:c.data,className:n.header,children:e.jsx("h2",{className:n.title,children:t==null?void 0:t.questions})}):null]}):null]})]}):e.jsx(ee,{to:"/"})}export{ye as default};
