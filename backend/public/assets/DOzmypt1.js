import{d as P,b as N,A as G,i as O,e as q,Q as A,k as K,j as e,c as n,f as L,R,a as f,F as I,m as V,n as H,u as D,y as W,N as X,M as Z,C as g}from"./B7DAq_4k.js";import{R as ee}from"./P0sdvjL8.js";import{b as se,c as te,d as ae,e as le,f as re}from"./CnUC6V4v.js";import{a as B,s as l,b as U}from"./BpR_VXzB.js";import{u as Q}from"./f4lojql9.js";import{s as c}from"./Bn4G0VvL.js";import{C as $}from"./DqT24KQI.js";import{a as ce,b as oe}from"./uNX39J6a.js";import{g as o}from"./CT1-FNmN.js";import{Y as ne}from"./BQMOT6f8.js";function ie({onMutateSuccess:r,setShowPopUp:a}){const t=P("component.create_school_class"),[b,v]=N.useState(!0),[i,F]=N.useState(""),S=Q(i,G),d=O(),_=()=>{v(!0),setTimeout(()=>{a(!1)},V.TRANSITION_TIMING_FAST)},C=H(c),E=q({queryKey:[A.AUTO_COMPLETE_FACULTY,{search:S}],queryFn:()=>B(S),enabled:!!S}),j=async s=>{var h;s.preventDefault(),(h=document.querySelector(`.${c["form-data"]}`))==null||h.querySelectorAll("input[name]").forEach(p=>{var x;p.classList.remove("error"),(x=C.getParentElement(p))==null||x.removeAttribute("data-error")});const m=s.nativeEvent.submitter,y=s.target,T=new FormData(y);await se(T),m.name==="save"?_():y.reset()},{mutate:w,isPending:u}=K({mutationFn:j,onError:s=>{C.showFormError(s)},onSuccess:r});return N.useEffect(()=>(v(!1),()=>{d.removeQueries({queryKey:[A.AUTO_COMPLETE_FACULTY]})}),[d]),e.jsxs("div",{className:n(c["create-model-container"],b?c.hide:""),children:[u?e.jsx(L,{}):null,e.jsxs("div",{className:n(c["create-model-form"],b?c.hide:""),children:[e.jsxs("div",{className:c.header,children:[e.jsx("h2",{className:c.title,children:t==null?void 0:t.create}),e.jsx("div",{className:c["esc-button"],onClick:_,children:e.jsx(R,{})})]}),e.jsx("div",{className:c["form-content"],children:e.jsxs("form",{onSubmit:s=>{w(s)},onInput:s=>{C.handleOnInput(s)},className:c["form-data"],children:[e.jsxs("div",{className:c["group-inputs"],children:[e.jsxs("div",{className:c["wrap-item"],children:[e.jsx("label",{className:c.required,htmlFor:"shortcode",children:t==null?void 0:t.shortcode}),e.jsx("input",{id:"shortcode",name:"shortcode",className:n(f["input-d"],c["input-item"]),type:"text"})]}),e.jsxs("div",{className:c["wrap-item"],children:[e.jsx("label",{className:c.required,htmlFor:"name",children:t==null?void 0:t.name}),e.jsx("input",{id:"name",name:"name",className:n(f["input-d"],c["input-item"]),type:"text"})]}),e.jsxs("div",{className:c["wrap-item"],children:[e.jsx("label",{className:c.required,htmlFor:"faculty_id",children:t==null?void 0:t.faculty}),e.jsx($,{name:"faculty_id",onInput:s=>{F(s.currentTarget.value)},options:E.data?E.data.map(s=>({label:s.name,value:String(s.id)})):[]})]})]}),e.jsxs("div",{className:c["action-items"],children:[e.jsxs("button",{name:"save",className:n(f["action-item-d"],u?f["button-submitting"]:""),children:[e.jsx(I,{}),t==null?void 0:t.save]}),e.jsxs("button",{name:"save-more",className:n(f["action-item-white-d"],u?f["button-submitting"]:""),children:[e.jsx(I,{}),t==null?void 0:t.saveMore]})]})]})})]})]})}function ue({id:r,onMutateSuccess:a,setShowPopUp:t}){var h,p;const[b,v]=N.useState(!0),i=P("component.view_school_class"),{permissions:F}=D(),[S,d]=N.useState(""),_=Q(S,G),C=O(),E=()=>{v(!0),setTimeout(()=>{t(!1)},V.TRANSITION_TIMING_FAST)},j=!F.has("school_class_update"),w=H(o),u=q({queryKey:[A.SCHOOL_CLASS_DETAIL,r],queryFn:()=>te(r)}),s=q({queryKey:[A.AUTO_COMPLETE_FACULTY,{search:_}],queryFn:()=>B(_),enabled:!!(_&&F.has("faculty_view"))}),m=async x=>{var M;x.preventDefault(),(M=document.querySelector(`.${o["form-data"]}`))==null||M.querySelectorAll("input[name]").forEach(k=>{var Y;k.classList.remove("error"),(Y=w.getParentElement(k))==null||Y.removeAttribute("data-error")});const z=x.target,J=new FormData(z);await ae(J,r)},{mutate:y,isPending:T}=K({mutationFn:m,onError:x=>{w.showFormError(x)},onSuccess:a});return N.useEffect(()=>(v(!1),()=>{C.removeQueries({queryKey:[A.SCHOOL_CLASS_DETAIL,{id:r}]}),C.removeQueries({queryKey:[A.AUTO_COMPLETE_FACULTY]})}),[r,C]),e.jsxs("div",{className:n(o["view-model-container"],b?o.hide:""),children:[T?e.jsx(L,{}):null,e.jsxs("div",{className:n(o["view-model-form"],b?o.hide:""),children:[e.jsxs("div",{className:o.header,children:[e.jsx("h2",{className:o.title,children:(h=u.data)==null?void 0:h.name}),e.jsx("div",{className:o["esc-button"],onClick:E,children:e.jsx(R,{})})]}),e.jsxs(e.Fragment,{children:[u.isLoading?e.jsx(L,{}):null,e.jsx("div",{className:o["form-content"],children:u.data?e.jsxs("form",{onSubmit:x=>{y(x)},onInput:x=>{w.handleOnInput(x)},className:o["form-data"],children:[e.jsxs("div",{className:o["group-inputs"],children:[e.jsxs("div",{className:o["wrap-item"],children:[e.jsx("label",{className:o.required,htmlFor:"shortcode",children:i==null?void 0:i.shortcode}),e.jsx("input",{id:"shortcode",disabled:j,defaultValue:u.data.shortcode,name:"shortcode",className:n(f["input-d"],o["input-item"]),type:"text"})]}),e.jsxs("div",{className:o["wrap-item"],children:[e.jsx("label",{className:o.required,htmlFor:"name",children:i==null?void 0:i.name}),e.jsx("input",{id:"name",disabled:j,defaultValue:u.data.name,name:"name",className:n(f["input-d"],o["input-item"]),type:"text"})]}),e.jsxs("div",{className:o["wrap-item"],children:[e.jsx("label",{className:o.required,htmlFor:"faculty_id",children:i==null?void 0:i.faculty}),e.jsx($,{name:"faculty_id",disabled:j,defaultOption:{label:(p=u.data.faculty)==null?void 0:p.name,value:u.data.faculty?String(u.data.faculty.id):""},onInput:x=>{d(x.currentTarget.value)},options:s.data?s.data.map(x=>({label:x.name,value:String(x.id)})):[]})]})]}),F.has("school_class_update")?e.jsx("div",{className:o["action-items"],children:e.jsxs("button",{name:"save",className:n(f["action-item-d"],T?f["button-submitting"]:""),children:[e.jsx(I,{}),i==null?void 0:i.save]})}):null]}):null})]})]})]})}function de({data:r,searchParams:a,onMutateSuccess:t,setSearchParams:b,setSelectedRows:v}){const{permissions:i}=D(),[F,S]=N.useState(!1),d=P("component.school_classes_table"),[_,C]=N.useState(!1),[E,j]=N.useState(0),w=(s,m)=>{const y=m.target;if(y.nodeName==="INPUT"){const T=y,h=Number(a.get("per_page"))||10;T.checked?v(p=>(p.add(s),p.size===h&&S(!0),structuredClone(p))):v(p=>(p.delete(s),p.size!==h&&S(!1),structuredClone(p)));return}j(s),C(!0)},u=s=>{const m=s.currentTarget,y=`.${l["column-select"]}>input`;document.querySelectorAll(y).forEach(h=>{const p=h;p.checked=m.checked}),m.checked?(v(h=>(h.clear(),r&&r.data.forEach(p=>{h.add(p.id)}),structuredClone(h))),S(!0)):(v(h=>(h.clear(),structuredClone(h))),S(!1))};return e.jsxs(e.Fragment,{children:[_===!0?e.jsx(ue,{id:E,onMutateSuccess:t,setShowPopUp:C}):null,e.jsxs("div",{className:l["table-content"],children:[e.jsx("table",{className:l.main,children:e.jsxs(e.Fragment,{children:[e.jsx("thead",{children:e.jsxs("tr",{className:l["table-header"],children:[i.has("school_class_delete")?e.jsx("th",{className:n(l["column-select"],l.column),children:e.jsx("input",{type:"checkbox",checked:F,onChange:u})}):null,e.jsx("th",{className:n(l.column,l.medium),children:d==null?void 0:d.header.shortcode}),e.jsx("th",{className:n(l.column,l.medium),children:d==null?void 0:d.header.name}),e.jsx("th",{className:n(l.column,l.medium),children:d==null?void 0:d.header.faculty})]})}),e.jsx("tbody",{children:r?r.data.map(s=>e.jsxs("tr",{onClick:m=>{w(s.id,m)},children:[i.has("faculty_delete")?e.jsx("td",{className:n(l.column,l.small,l["column-select"]),children:e.jsx("input",{type:"checkbox"})}):null,e.jsx("td",{className:n(l.column,l.medium),children:s.shortcode}),e.jsx("td",{className:n(l.column,l.medium),children:s.name}),e.jsx("td",{className:n(l.column,l.medium),children:s.faculty.name})]},s.id)):null})]})}),r?e.jsxs("div",{className:l["table-footer"],children:[e.jsxs("span",{children:[r.from," - ",r.to," / ",r.total]}),e.jsx("div",{className:l["table-links"],children:e.jsx("div",{className:l["link-content"],children:r.links.map(s=>isNaN(Number(s.label))?e.jsx("button",{className:l["next-previous"],onClick:()=>{if(!s.url)return;const m=new URL(s.url);a.set("page",m.searchParams.get("page")||"1"),b(a)},children:s.label==="..."?"...":s.label.includes("Next")?e.jsx(ce,{}):e.jsx(oe,{})},"faculty"+s.label):e.jsx("button",{className:n(f["button-d"],s.active?"":l.inactive),onClick:()=>{if(!s.url)return;const m=new URL(s.url);a.set("page",m.searchParams.get("page")||"1"),b(a)},children:s.label},"faculty"+s.label))})})]}):null]})]})}function ve(){const{permissions:r}=D(),a=P("page.school_classes"),[t,b]=W(),[v,i]=N.useState(!1),[F,S]=N.useState(!1),[d,_]=N.useState(new Set),[C,E]=N.useState(t.get("search")||""),j=Q(C),w=O(),u=q({queryKey:[A.PAGE_SCHOOL_CLASSES,{page:t.get("page")||"1",perPage:t.get("per_page")||"10",search:j}],queryFn:()=>le({page:Number(t.get("page")),perPage:Number(t.get("per_page")),search:j}),enabled:r.has("school_class_view")}),s=async()=>{await re(Array.from(d))},m=()=>{[A.PAGE_SCHOOL_CLASSES].forEach(y=>{w.refetchQueries({queryKey:[y]})})};return N.useEffect(()=>{_(new Set)},[u.data]),N.useEffect(()=>{!t.get("search")&&!j||(j===""?t.delete("search"):t.set("search",j),b(t))},[j,t,b]),r.has("school_class_view")?e.jsxs(e.Fragment,{children:[v===!0?e.jsx(ie,{onMutateSuccess:m,setShowPopUp:i}):null,F===!0?e.jsx(ne,{message:(a==null?void 0:a.deleteMessage.replace("@n",String(d.size)))||"",mutateFunction:s,setShowPopUp:S,onMutateSuccess:m,langYes:a==null?void 0:a.langYes,langNo:a==null?void 0:a.langNo}):null,e.jsxs("main",{className:f["dashboard-d"],children:[r.hasAnyFormList(["school_class_create","school_class_delete"])?e.jsxs("section",{className:f["action-bar-d"],children:[r.has("school_class_create")?e.jsxs("div",{className:f["action-item-d"],onClick:()=>{i(!0)},children:[e.jsx(ee,{})," ",a==null?void 0:a.add]}):null,d.size>0&&r.has("school_class_delete")?e.jsxs("div",{onClick:()=>{S(!0)},className:f["action-item-white-border-red-d"],children:[e.jsx(Z,{})," ",a==null?void 0:a.delete]}):null]}):null,e.jsxs("section",{className:U["table-page-content"],children:[e.jsxs("div",{className:U["filter-form"],children:[e.jsxs("div",{className:U["wrap-input-item"],children:[e.jsx("label",{children:a==null?void 0:a.filter.perPage}),e.jsx(g,{defaultOption:{label:"10",value:"10"},options:[{label:"10",value:"10"},{label:"20",value:"20"},{label:"30",value:"30"},{label:"40",value:"40"},{label:"50",value:"50"}],onChange:y=>{t.set("per_page",y.value),b(t)},className:U["custom-select"]})]}),e.jsxs("div",{className:U["wrap-input-item"],children:[e.jsx("label",{children:a==null?void 0:a.filter.search}),e.jsx("input",{onInput:y=>{E(y.currentTarget.value)},defaultValue:j,className:n(f["input-d"],U["input-item"])})]})]}),e.jsxs("div",{className:U["wrap-table"],children:[u.isLoading?e.jsx(L,{}):null,u.isError?null:e.jsx(de,{data:u.data,searchParams:t,onMutateSuccess:m,setSearchParams:b,setSelectedRows:_})]})]})]})]}):e.jsx(X,{to:"/"})}export{ve as default};
