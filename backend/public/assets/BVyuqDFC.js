import{d as L,b as y,A as V,i as Q,e as P,Q as T,S as Y,k as B,j as e,c as l,f as I,R as $,a as h,v as D,F as O,m as z,n as H,u as M,y as Z,N as g,M as ee,C as se}from"./B7DAq_4k.js";import{R as te}from"./P0sdvjL8.js";import{c as ae,d as re,e as le,s as t,f as ce,b as A,g as ne}from"./BpR_VXzB.js";import{u as k}from"./f4lojql9.js";import{s as n}from"./Bn4G0VvL.js";import{C as J}from"./DqT24KQI.js";import{a as ie,b as oe}from"./uNX39J6a.js";import{g as i}from"./CT1-FNmN.js";import{Y as me}from"./BQMOT6f8.js";function de({onMutateSuccess:o,setShowPopUp:a}){const r=L("component.create_faculty"),[_,F]=y.useState(!0),[c,u]=y.useState(""),b=k(c,V),m=Q(),C=()=>{F(!0),setTimeout(()=>{a(!1)},z.TRANSITION_TIMING_FAST)},S=H(n),x=P({queryKey:[T.AUTO_COMPLETE_USER,{search:b}],queryFn:()=>Y("teacher",b),enabled:!!b}),w=async s=>{var j;s.preventDefault(),(j=document.querySelector(`.${n["form-data"]}`))==null||j.querySelectorAll("input[name]").forEach(f=>{var q;f.classList.remove("error"),(q=S.getParentElement(f))==null||q.removeAttribute("data-error")});const p=s.nativeEvent.submitter,N=s.target,E=new FormData(N);await ae(E),p.name==="save"?C():N.reset()},{mutate:U,isPending:d}=B({mutationFn:w,onError:s=>{S.showFormError(s)},onSuccess:o});return y.useEffect(()=>(F(!1),()=>{m.removeQueries({queryKey:[T.AUTO_COMPLETE_USER]})}),[m]),e.jsxs("div",{className:l(n["create-model-container"],_?n.hide:""),children:[d?e.jsx(I,{}):null,e.jsxs("div",{className:l(n["create-model-form"],_?n.hide:""),children:[e.jsxs("div",{className:n.header,children:[e.jsx("h2",{className:n.title,children:r==null?void 0:r.create}),e.jsx("div",{className:n["esc-button"],onClick:C,children:e.jsx($,{})})]}),e.jsx("div",{className:n["form-content"],children:e.jsxs("form",{onSubmit:s=>{U(s)},onInput:s=>{S.handleOnInput(s)},className:n["form-data"],children:[e.jsxs("div",{className:n["group-inputs"],children:[e.jsxs("div",{className:n["wrap-item"],children:[e.jsx("label",{className:n.required,htmlFor:"shortcode",children:r==null?void 0:r.shortcode}),e.jsx("input",{id:"shortcode",name:"shortcode",className:l(h["input-d"],n["input-item"]),type:"text"})]}),e.jsxs("div",{className:n["wrap-item"],children:[e.jsx("label",{className:n.required,htmlFor:"name",children:r==null?void 0:r.name}),e.jsx("input",{id:"name",name:"name",className:l(h["input-d"],n["input-item"]),type:"text"})]}),e.jsxs("div",{className:n["wrap-item"],children:[e.jsx("label",{htmlFor:"email",children:r==null?void 0:r.email}),e.jsx("input",{id:"email",name:"email",className:l(h["input-d"],n["input-item"]),type:"text"})]}),e.jsxs("div",{className:n["wrap-item"],children:[e.jsx("label",{htmlFor:"phone_number",children:r==null?void 0:r.phoneNumber}),e.jsx("input",{id:"phone_number",name:"phone_number",className:l(h["input-d"],n["input-item"]),type:"text"})]}),e.jsxs("div",{className:n["wrap-item"],children:[e.jsx("label",{htmlFor:"leader_id",children:r==null?void 0:r.leader}),e.jsx(J,{name:"leader_id",onInput:s=>{u(s.currentTarget.value)},options:x.data?x.data.map(s=>({label:D.getFullName(s.firstName,s.lastName),value:String(s.id)})):[],className:n["custom-select"]})]})]}),e.jsxs("div",{className:n["action-items"],children:[e.jsxs("button",{name:"save",className:l(h["action-item-d"],d?h["button-submitting"]:""),children:[e.jsx(O,{}),r==null?void 0:r.save]}),e.jsxs("button",{name:"save-more",className:l(h["action-item-white-d"],d?h["button-submitting"]:""),children:[e.jsx(O,{}),r==null?void 0:r.saveMore]})]})]})})]})]})}function ue({id:o,onMutateSuccess:a,setShowPopUp:r}){var j,f,q;const[_,F]=y.useState(!0),c=L("component.view_faculty"),{permissions:u}=M(),[b,m]=y.useState(""),C=k(b,V),S=Q(),x=!u.has("faculty_update"),w=()=>{F(!0),setTimeout(()=>{r(!1)},z.TRANSITION_TIMING_FAST)},U=H(i),d=P({queryKey:[T.FACULTY_DETAIL,{id:o}],queryFn:()=>re(o)}),s=P({queryKey:[T.AUTO_COMPLETE_USER,{search:C}],queryFn:()=>Y("teacher",C),enabled:!!(C&&u.has("user_view"))}),p=async v=>{var R;v.preventDefault(),(R=document.querySelector(`.${i["form-data"]}`))==null||R.querySelectorAll("input[name]").forEach(G=>{var K;G.classList.remove("error"),(K=U.getParentElement(G))==null||K.removeAttribute("data-error")});const W=v.target,X=new FormData(W);await le(X,o)},{mutate:N,isPending:E}=B({mutationFn:p,onError:v=>{U.showFormError(v)},onSuccess:a});return y.useEffect(()=>(F(!1),()=>{S.removeQueries({queryKey:[T.FACULTY_DETAIL,{id:o}]}),S.removeQueries({queryKey:[T.AUTO_COMPLETE_USER]})}),[o,S]),e.jsxs("div",{className:l(i["view-model-container"],_?i.hide:""),children:[E?e.jsx(I,{}):null,e.jsxs("div",{className:l(i["view-model-form"],_?i.hide:""),children:[e.jsxs("div",{className:i.header,children:[e.jsx("h2",{className:i.title,children:(j=d.data)==null?void 0:j.name}),e.jsx("div",{className:i["esc-button"],onClick:w,children:e.jsx($,{})})]}),e.jsxs(e.Fragment,{children:[d.isLoading?e.jsx(I,{}):null,e.jsx("div",{className:i["form-content"],children:d.data?e.jsxs("form",{onSubmit:v=>{N(v)},onInput:v=>{U.handleOnInput(v)},className:i["form-data"],children:[e.jsxs("div",{className:i["group-inputs"],children:[e.jsxs("div",{className:i["wrap-item"],children:[e.jsx("label",{className:i.required,htmlFor:"shortcode",children:c==null?void 0:c.shortcode}),e.jsx("input",{id:"shortcode",disabled:x,defaultValue:d.data.shortcode,name:"shortcode",className:l(h["input-d"],i["input-item"]),type:"text"})]}),e.jsxs("div",{className:i["wrap-item"],children:[e.jsx("label",{className:i.required,htmlFor:"name",children:c==null?void 0:c.name}),e.jsx("input",{id:"name",disabled:x,defaultValue:d.data.name,name:"name",className:l(h["input-d"],i["input-item"]),type:"text"})]}),e.jsxs("div",{className:i["wrap-item"],children:[e.jsx("label",{htmlFor:"email",children:c==null?void 0:c.email}),e.jsx("input",{id:"email",disabled:x,defaultValue:d.data.email||"",name:"email",className:l(h["input-d"],i["input-item"]),type:"text"})]}),e.jsxs("div",{className:i["wrap-item"],children:[e.jsx("label",{htmlFor:"phone_number",children:c==null?void 0:c.phoneNumber}),e.jsx("input",{id:"phone_number",disabled:x,defaultValue:d.data.phoneNumber||"",name:"phone_number",className:l(h["input-d"],i["input-item"]),type:"text"})]}),e.jsxs("div",{className:i["wrap-item"],children:[e.jsx("label",{htmlFor:"leader_id",children:c==null?void 0:c.leader}),e.jsx(J,{name:"leader_id",defaultOption:{label:D.getFullName((f=d.data.leader)==null?void 0:f.firstName,(q=d.data.leader)==null?void 0:q.lastName),value:d.data.leader?String(d.data.leader.id):""},disabled:x,onInput:v=>{m(v.currentTarget.value)},options:s.data?s.data.map(v=>({label:D.getFullName(v.firstName,v.lastName),value:String(v.id)})):[],className:i["custom-select"]})]})]}),u.has("faculty_update")?e.jsx("div",{className:i["action-items"],children:e.jsxs("button",{name:"save",className:l(h["action-item-d"],E?h["button-submitting"]:""),children:[e.jsx(O,{}),c==null?void 0:c.save]})}):null]}):null})]})]})]})}function he({data:o,searchParams:a,onMutateSuccess:r,setSearchParams:_,setSelectedRows:F}){const{permissions:c}=M(),[u,b]=y.useState(!1),m=L("component.faculties_table"),[C,S]=y.useState(!1),[x,w]=y.useState(0),U=(s,p)=>{const N=p.target;if(N.nodeName==="INPUT"){const E=N,j=Number(a.get("per_page"))||10;E.checked?F(f=>(f.add(s),f.size===j&&b(!0),structuredClone(f))):F(f=>(f.delete(s),f.size!==j&&b(!1),structuredClone(f)));return}w(s),S(!0)},d=s=>{const p=s.currentTarget,N=`.${t["column-select"]}>input`;document.querySelectorAll(N).forEach(j=>{const f=j;f.checked=p.checked}),p.checked?(F(j=>(j.clear(),o&&o.data.forEach(f=>{j.add(f.id)}),structuredClone(j))),b(!0)):(F(j=>(j.clear(),structuredClone(j))),b(!1))};return e.jsxs(e.Fragment,{children:[C===!0?e.jsx(ue,{id:x,onMutateSuccess:r,setShowPopUp:S}):null,e.jsxs("div",{className:t["table-content"],children:[e.jsx("table",{className:t.main,children:e.jsxs(e.Fragment,{children:[e.jsx("thead",{children:e.jsxs("tr",{className:t["table-header"],children:[c.has("faculty_delete")?e.jsx("th",{className:l(t["column-select"],t.column),children:e.jsx("input",{type:"checkbox",checked:u,onChange:d})}):null,e.jsx("th",{className:l(t.column,t.medium),children:m==null?void 0:m.header.shortcode}),e.jsx("th",{className:l(t.column,t.medium),children:m==null?void 0:m.header.name}),e.jsx("th",{className:l(t.column,t.medium),children:m==null?void 0:m.header.phoneNumber}),e.jsx("th",{className:l(t.column,t.medium),children:m==null?void 0:m.header.email}),e.jsx("th",{className:l(t.column,t.medium),children:m==null?void 0:m.header.leader})]})}),e.jsx("tbody",{children:o?o.data.map(s=>{var p,N;return e.jsxs("tr",{onClick:E=>{U(s.id,E)},children:[c.has("faculty_delete")?e.jsx("td",{className:l(t.column,t.small,t["column-select"]),children:e.jsx("input",{type:"checkbox"})}):null,e.jsx("td",{className:l(t.column,t.medium),children:s.shortcode}),e.jsx("td",{className:l(t.column,t.medium),children:s.name}),e.jsx("td",{className:l(t.column,t.medium),children:s.phoneNumber}),e.jsx("td",{className:l(t.column,t.medium),children:s.email}),e.jsx("td",{className:l(t.column,t.medium),children:D.getFullName((p=s.leader)==null?void 0:p.firstName,(N=s.leader)==null?void 0:N.lastName)})]},s.id)}):null})]})}),o?e.jsxs("div",{className:t["table-footer"],children:[e.jsxs("span",{children:[o.from," - ",o.to," / ",o.total]}),e.jsx("div",{className:t["table-links"],children:e.jsx("div",{className:t["link-content"],children:o.links.map(s=>isNaN(Number(s.label))?e.jsx("button",{className:t["next-previous"],onClick:()=>{if(!s.url)return;const p=new URL(s.url);a.set("page",p.searchParams.get("page")||"1"),_(a)},children:s.label==="..."?"...":s.label.includes("Next")?e.jsx(ie,{}):e.jsx(oe,{})},"faculty"+s.label):e.jsx("button",{className:l(h["button-d"],s.active?"":t.inactive),onClick:()=>{if(!s.url)return;const p=new URL(s.url);a.set("page",p.searchParams.get("page")||"1"),_(a)},children:s.label},"faculty"+s.label))})})]}):null]})]})}function Se(){const{permissions:o}=M(),a=L("page.faculties"),[r,_]=y.useState(!1),[F,c]=y.useState(!1),[u,b]=Z(),m=Q(),[C,S]=y.useState(u.get("search")||""),x=k(C),[w,U]=y.useState(new Set),d=P({queryKey:[T.PAGE_FACULTIES,{page:u.get("page")||"1",perPage:u.get("per_page")||"10",search:x}],queryFn:()=>ce({page:Number(u.get("page")),perPage:Number(u.get("per_page")),search:x}),enabled:o.has("faculty_view")}),s=async()=>{await ne(Array.from(w))},p=()=>{[T.PAGE_FACULTIES].forEach(N=>{m.refetchQueries({queryKey:[N]})})};return y.useEffect(()=>{U(new Set)},[d.data]),y.useEffect(()=>{!u.get("search")&&!x||(x===""?u.delete("search"):u.set("search",x),b(u))},[x,u,b]),o.has("faculty_view")?e.jsxs(e.Fragment,{children:[r===!0?e.jsx(de,{onMutateSuccess:p,setShowPopUp:_}):null,F===!0?e.jsx(me,{message:(a==null?void 0:a.deleteMessage.replace("@n",String(w.size)))||"",mutateFunction:s,setShowPopUp:c,onMutateSuccess:p,langYes:a==null?void 0:a.langYes,langNo:a==null?void 0:a.langNo}):null,e.jsxs("main",{className:h["dashboard-d"],children:[o.hasAnyFormList(["faculty_create","faculty_delete"])?e.jsxs("section",{className:h["action-bar-d"],children:[o.has("faculty_create")?e.jsxs("div",{className:h["action-item-d"],onClick:()=>{_(!0)},children:[e.jsx(te,{})," ",a==null?void 0:a.add]}):null,w.size>0&&o.has("faculty_delete")?e.jsxs("div",{onClick:()=>{c(!0)},className:h["action-item-white-border-red-d"],children:[e.jsx(ee,{})," ",a==null?void 0:a.delete]}):null]}):null,e.jsxs("section",{className:A["table-page-content"],children:[e.jsxs("div",{className:A["filter-form"],children:[e.jsxs("div",{className:A["wrap-input-item"],children:[e.jsx("label",{children:a==null?void 0:a.filter.perPage}),e.jsx(se,{defaultOption:{label:"10",value:"10"},options:[{label:"10",value:"10"},{label:"20",value:"20"},{label:"30",value:"30"},{label:"40",value:"40"},{label:"50",value:"50"}],onChange:N=>{u.set("per_page",N.value),b(u)},className:A["custom-select"]})]}),e.jsxs("div",{className:A["wrap-input-item"],children:[e.jsx("label",{children:a==null?void 0:a.filter.search}),e.jsx("input",{onInput:N=>{S(N.currentTarget.value)},defaultValue:x,className:l(h["input-d"],A["input-item"])})]})]}),e.jsxs("div",{className:A["wrap-table"],children:[d.isLoading?e.jsx(I,{}):null,d.isError?null:e.jsx(he,{data:d.data,searchParams:u,onMutateSuccess:p,setSearchParams:b,setSelectedRows:U})]})]})]})]}):e.jsx(g,{to:"/"})}export{Se as default};
