import{G as P,u as U,b as m,d as _,O as k,e as A,Q as I,j as e,N as M,c as i,a as c,f as R,a0 as q,v as N,L as D,a1 as f,a2 as O,H as Q}from"./B7DAq_4k.js";import{b as B,f as b,g as G}from"./hUW0gmcn.js";import{Y as E}from"./BQMOT6f8.js";import{c as T}from"./CyB2zc_o.js";import{s as H}from"./CGbjptuF.js";function z(l){return P({tag:"svg",attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 0c-4.418 0-8 3.582-8 8s3.582 8 8 8 8-3.582 8-8-3.582-8-8-8zM8 14.5c-3.59 0-6.5-2.91-6.5-6.5s2.91-6.5 6.5-6.5 6.5 2.91 6.5 6.5-2.91 6.5-6.5 6.5z"},child:[]},{tag:"path",attr:{d:"M10.5 4l-2.5 2.5-2.5-2.5-1.5 1.5 2.5 2.5-2.5 2.5 1.5 1.5 2.5-2.5 2.5 2.5 1.5-1.5-2.5-2.5 2.5-2.5z"},child:[]}]})(l)}const X="eh0OfSE1fxM-",V="_5CYoehqizVY-",$="MvdpN1t9l-U-",J="t1Oj5H1898E-",K="pS1t1G2bgiI-",W="b5HGoRvXDYQ-",Z="_7oEOnY8LomE-",g="-xGWicgJcII-",ss="M4niuC5ZFTc-",es="k0m9nAx4hww-",ts="uq4BETwHpdc-",t={"page-content":"oLYX6qedhQ0-",header:X,title:V,"exam-info-container":"PBHP4Fd9-IU-","exam-info":"hklcxg4MFR4-","group-infos":"A4CLT3h2FGg-","wrap-item":"_55pP4VnPY78-","supervisors-container":"v-9UluS7sAo-","action-items":"wcgewq6-AFk-",pending:$,"result-container":"_5QNONOTPRvA-","table-container":"_9VJtXD2D91Q-",table:J,column:K,tiny:W,small:Z,medium:g,large:ss,"super-large":"eyHYEmhC7RQ-",refreshing:es,rotate:ts};function os(){var p;const{user:l,appLanguage:S,permissions:r}=U(),[w,d]=m.useState(!1),[v,x]=m.useState(!1),[C,h]=m.useState(!1),s=_("page.exam"),{id:o}=k(),y=async()=>{await b("start",String(o))},F=async()=>{await b("cancel",String(o))},a=A({queryKey:[I.EXAM,{id:o}],queryFn:()=>B(String(o)),refetchOnWindowFocus:!1,enabled:r.has("exam_view")}),u=()=>{a.refetch()},Y=a.data?((p=a.data.result.find(n=>n.studentId===l.user.id))==null?void 0:p.correctCount)!==null:!1,L=()=>{d(!0);const n=`Exam-${o}-${new Date().toISOString().split("T")[0]}.xlsx`;G(String(o),n).then(j=>{H(j.data,j.fileName)}).finally(()=>{d(!1)})};return r.has("exam_view")?e.jsxs(e.Fragment,{children:[v===!0?e.jsx(E,{message:(s==null?void 0:s.startMessage)||"",mutateFunction:y,setShowPopUp:x,onMutateSuccess:u,langYes:s==null?void 0:s.langYes,langNo:s==null?void 0:s.langNo}):null,C===!0?e.jsx(E,{message:(s==null?void 0:s.cancelMessage)||"",mutateFunction:F,setShowPopUp:h,onMutateSuccess:u,langYes:s==null?void 0:s.langYes,langNo:s==null?void 0:s.langNo}):null,e.jsxs("main",{className:i(c["dashboard-d"],t["page-content"]),children:[a.isLoading?e.jsx(R,{}):null,a.data?e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:t["exam-info-container"],children:[e.jsx("div",{className:t.header,children:e.jsx("h2",{className:t.title,children:s==null?void 0:s.exam})}),e.jsx("div",{className:t["exam-info"],children:e.jsxs("div",{className:t["group-infos"],children:[e.jsxs("div",{className:t["wrap-item"],children:[e.jsxs("label",{children:[s==null?void 0:s.name,": "]}),e.jsx("p",{children:a.data.name})]}),e.jsxs("div",{className:t["wrap-item"],children:[e.jsxs("label",{children:[s==null?void 0:s.examDate,": "]}),e.jsx("p",{children:new Date(a.data.examDate).toLocaleString(S.language)})]}),e.jsxs("div",{className:t["wrap-item"],children:[e.jsxs("label",{children:[s==null?void 0:s.examTime,": "]}),e.jsx("p",{children:q.duration(a.data.examTime,"minutes").humanize()})]}),e.jsxs("div",{className:i(t["wrap-item"],t["supervisors-container"]),children:[e.jsx("label",{children:s==null?void 0:s.supervisors}),e.jsx("p",{children:a.data.examSupervisors.map(n=>N.getFullName(n.user.firstName,n.user.lastName)).join(", ")})]})]})}),r.hasAnyFormList(["exam_update","exam_submit"])?e.jsxs("div",{className:t["action-items"],children:[r.has("exam_submit")&&a.data.startedAt!==null&&!Y?e.jsx(e.Fragment,{children:e.jsxs(D,{style:{width:"fit-content"},to:"take",type:"button",className:c["action-item-d"],children:[e.jsx(f,{}),s==null?void 0:s.doExam]})}):null,r.has("exam_update")?e.jsxs(e.Fragment,{children:[r.has("exam_update")&&a.data.startedAt===null?e.jsxs("button",{onClick:()=>{x(!0)},type:"button",className:c["action-item-d"],children:[e.jsx(f,{})," ",s==null?void 0:s.startExam]}):null,e.jsxs("button",{type:"button",onClick:()=>{h(!0)},className:c["action-item-white-border-red-d"],children:[e.jsx(z,{})," ",s==null?void 0:s.cancelExam]})]}):null]}):null]}),e.jsxs("section",{className:t["result-container"],children:[e.jsx("div",{className:t.header,children:e.jsx("h2",{className:t.title,children:s==null?void 0:s.result})}),e.jsxs("div",{className:c["action-bar-d"],style:{marginBottom:"20px"},children:[e.jsxs("button",{className:i(a.isFetching?c["button-submitting"]:"",a.isFetching?t.refreshing:"",c["action-item-d"]),onClick:()=>{a.refetch()},children:[e.jsx(O,{}),s==null?void 0:s.refresh]}),e.jsxs("button",{className:i(w?c["button-submitting"]:"",c["action-item-white-d"]),onClick:L,children:[e.jsx(Q,{}),s==null?void 0:s.export]})]}),e.jsx("div",{className:t["table-container"],children:e.jsxs("table",{className:t.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:i(t.column,t["super-large"]),children:s==null?void 0:s.name}),e.jsx("th",{className:i(t.column,t.medium),children:s==null?void 0:s.schoolClass}),e.jsx("th",{className:i(t.column,t.medium),children:s==null?void 0:s.genders.gender}),e.jsx("th",{className:i(t.column,t.medium),children:s==null?void 0:s.score})]})}),e.jsx("tbody",{children:a.data.result.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:i(t.column,t["super-large"]),children:N.getFullName(n.firstName,n.lastName)}),e.jsx("td",{className:i(t.column,t.medium),children:n.schoolClassShortcode}),e.jsx("td",{className:i(t.column,t.medium),children:s==null?void 0:s.genders[n.gender]}),e.jsx("td",{className:i(t.column,t.medium),children:n.correctCount===null?s==null?void 0:s.didNotSubmitted:T(n.correctCount,n.questionCount)})]},`exam-result-${n.studentId}`))})]})})]})]}):null]})]}):e.jsx(M,{to:"/"})}export{os as default};
